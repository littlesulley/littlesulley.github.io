<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">
<link rel="preconnect" href="https://fonts.loli.net" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Roboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"sulley.cc","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="This post briefly introduces how FBX files are imported into Unreal Engine, particularly for animation sequences.">
<meta property="og:type" content="article">
<meta property="og:title" content="How are FBX files Imported in Unreal Engine">
<meta property="og:url" content="http://sulley.cc/2023/02/19/12/52/index.html">
<meta property="og:site_name" content="Sulley">
<meta property="og:description" content="This post briefly introduces how FBX files are imported into Unreal Engine, particularly for animation sequences.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-02-19T04:52:33.000Z">
<meta property="article:modified_time" content="2023-02-23T15:15:14.720Z">
<meta property="article:author" content="Sulley">
<meta property="article:tag" content="计算机">
<meta property="article:tag" content="UE">
<meta property="article:tag" content="游戏">
<meta property="article:tag" content="编辑器">
<meta property="article:tag" content="动画">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://sulley.cc/2023/02/19/12/52/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://sulley.cc/2023/02/19/12/52/","path":"2023/02/19/12/52/","title":"How are FBX files Imported in Unreal Engine"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>How are FBX files Imported in Unreal Engine | Sulley</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Sulley</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Never Betray Yourself.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-photography"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>Photography</a></li><li class="menu-item menu-item-resources"><a href="/resources/" rel="section"><i class="fa fa-book fa-fw"></i>Resources</a></li><li class="menu-item menu-item-comments"><a href="/comments/" rel="section"><i class="fa fa-comment fa-fw"></i>Comments</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#find-valid-bone-names"><span class="nav-number">1.</span> <span class="nav-text"> Find Valid Bone Names</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#import-blend-shapes"><span class="nav-number">2.</span> <span class="nav-text"> Import Blend Shapes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#import-animation"><span class="nav-number">3.</span> <span class="nav-text"> Import Animation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#import-bone-metadata"><span class="nav-number">4.</span> <span class="nav-text"> Import Bone Metadata</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sulley</p>
  <div class="site-description" itemprop="description">Through a sea of petals will I see a road to the far far heaven.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/littlesulley" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;littlesulley" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/qinghong-han-4a6a7918a/" title="Linkedin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;qinghong-han-4a6a7918a&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>Linkedin</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:qinghonghan97@gmail.com" title="E-Mail → mailto:qinghonghan97@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
        <div class="pjax">
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    Related Posts
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2023/03/02/10/53/" rel="bookmark">
        <time class="popular-posts-time">2023-03-02</time>
        <br>
      Customizing Actor's Details Panel and Accessing its CDO Components
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2022/11/21/16/03/" rel="bookmark">
        <time class="popular-posts-time">2022-11-21</time>
        <br>
      A Brief Note on Version Control and Project Organization
      </a>
    </li>
  </ul>

          </div>
        </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://sulley.cc/2023/02/19/12/52/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sulley">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sulley">
      <meta itemprop="description" content="Through a sea of petals will I see a road to the far far heaven.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="How are FBX files Imported in Unreal Engine | Sulley">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          How are FBX files Imported in Unreal Engine
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-02-19 12:52:33" itemprop="dateCreated datePublished" datetime="2023-02-19T12:52:33+08:00">2023-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-02-23 23:15:14" itemprop="dateModified" datetime="2023-02-23T23:15:14+08:00">2023-02-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B8%B8%E6%88%8F-%E5%8A%A8%E7%94%BB/" itemprop="url" rel="index"><span itemprop="name">游戏 - 动画</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2023/02/19/12/52/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2023/02/19/12/52/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>5.4k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>5 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>This post briefly introduces how FBX files are imported into Unreal Engine, particularly for animation sequences.</p>
<span id="more"></span>
<p>In <code>SkeletalMeshEdit.cpp</code>, you can find the function <code>bool UnFbx::UnFFbxImporter::ImportAnimation</code>, and this is where FBX import takes place.</p>
<h1 id="find-valid-bone-names"><a class="markdownIt-Anchor" href="#find-valid-bone-names"></a> Find Valid Bone Names</h1>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TArray&lt;FName&gt; FbxRawBoneNames;</span><br><span class="line"><span class="built_in">FillAndVerifyBoneNames</span>(Skeleton, SortedLinks, FbxRawBoneNames, FileName);</span><br><span class="line"><span class="function">FAnimCurveImportSettings <span class="title">AnimImportSettings</span><span class="params">(DestSeq, NodeArray, SortedLinks, FbxRawBoneNames, AnimTimeSpan)</span></span>;</span><br></pre></td></tr></table></figure>
<p>Function <code>FillAndVerifyBoneNames</code> will copy all bone names into <code>FbxRawBoneNames</code> and verify whether they are duplicate or invalid. <code>FbxRawBoneNames</code> now contains all valid bone names.</p>
<p><code>AnimImportSettings</code> is a helper structure to pass around the common animation parameters including the AnimationSequence asset reference, FBX nodes, bone names, and animation time span.</p>
<h1 id="import-blend-shapes"><a class="markdownIt-Anchor" href="#import-blend-shapes"></a> Import Blend Shapes</h1>
<p>Having everything prepared, we can import raw animation curves into the AnimationSequence asset. The first type of data we would like to import is the blend shape (morph target) curves. This is implemented by function <code>ImportBlendShapeCurves</code>.</p>
<p>The function process can be described using the following pseudo code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">foreach (FBXNode : FBXNodeArray) </span><br><span class="line">    foreach (BlendShape : FBXNode-&gt;BlendShapes)</span><br><span class="line">        foreach (Channel : BlendShape-&gt;BlendShapeChannels)</span><br><span class="line">        &#123;</span><br><span class="line">            FbxAnimCurve* Curve = GetShapeChannel (BlendShape, Channel)</span><br><span class="line">            if (ShouldImportCurve (Curve))</span><br><span class="line">            &#123;</span><br><span class="line">                int TargetShapeCount = Channel-&gt;GetTargetShapeCount()</span><br><span class="line">                if (TargetShapeCount &gt; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (TargetShapeCount == 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        ImportCurveToAnimSequence (AnimSeq, Channel, Curve)</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        // Scale blend shapes values by 0.01</span><br><span class="line">                        Algo::Transform(FbxInbetweenFullWeights, InbetweenFullWeights, [](double Input)&#123; return Input * 0.01f; &#125;)</span><br><span class="line"></span><br><span class="line">                        // Collect inbetween shape names</span><br><span class="line">                        for (int32 InbetweenIndex = 0; InbetweenIndex &lt; InbetweenCount; ++InbetweenIndex)</span><br><span class="line">						&#123;</span><br><span class="line">							FbxShape* Shape = Channel-&gt;GetTargetShape(InbetweenIndex)</span><br><span class="line">							CurveNames.Add(MakeName(Shape-&gt;GetName()))</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">                        // Convert FBX curve into rich curve</span><br><span class="line">                        FRichCurve ChannelWeightCurve;</span><br><span class="line">						ImportCurve(Curve, ChannelWeightCurve)</span><br><span class="line">						if (AnimSeq)</span><br><span class="line">						&#123;</span><br><span class="line">							ChannelWeightCurve.BakeCurve(1.0f / AnimSeq-&gt;ImportResampleFramerate)</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">                        // Use the primary curve to generate inbetween shape curves + a modified primary curve</span><br><span class="line">                        TArray&lt;FRichCurve&gt; Results = ResolveWeightsForBlendShapeCurve(ChannelWeightCurve, InbetweenFullWeights)</span><br><span class="line">						if (ImportRichCurvesToAnimSequence(AnimSeq, CurveNames, Results, 0))</span><br><span class="line">						&#123;</span><br><span class="line">							for (const FString&amp; CurveName : CurveNames)</span><br><span class="line">								MySkeleton-&gt;AccumulateCurveMetaData(*CurveName, false, true)</span><br><span class="line">						&#125;	</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>The function <code>ImportRichCurvesToAnimSequence</code> is worth particular attention. It  practically updates the AnimationSequence with the curves created and modified in function <code>ImportBlendShapeCurves</code>.</p>
<p>Let’s first examine the function <code>ImportRichCurvesToAnimSequence</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">foreach (CurveName : CurveNames)</span><br><span class="line">&#123;</span><br><span class="line">    // Add or retrieve curve</span><br><span class="line">    if (!SkeletonCurveMapping-&gt;Exists(CurveName))</span><br><span class="line">    &#123;</span><br><span class="line">        // Make skeleton dirty</span><br><span class="line">        Skeleton-&gt;Modify()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Get corresponding curve</span><br><span class="line">    FAnimationCurveIdentifier FloatCurveId (CurveName, ERawCurveTrackTypes::RCT_Float)</span><br><span class="line">    const FFloatCurve* TargetCurve = AnimSeq-&gt;GetDataModel()-&gt;FindFloatCurve(FloatCurveId)</span><br><span class="line"></span><br><span class="line">    // Update curve and set keys</span><br><span class="line">	AnimSeq-&gt;Controller.SetCurveKeys(FloatCurveId, RichCurves[CurveIndex].GetConstRefOfKeys())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, let’s examine function <code>SetCurveKeys</code>, which is defined in <code>AnimDataContyroller.cpp</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Get the curve according to curve id</span><br><span class="line">FRichCurve* RichCurve = Model-&gt;GetMutableRichCurve(CurveId)</span><br><span class="line"></span><br><span class="line">if (RichCurve)</span><br><span class="line">&#123;</span><br><span class="line">    // Set rich curve values</span><br><span class="line">	RichCurve-&gt;SetKeys(CurveKeys);</span><br><span class="line"></span><br><span class="line">    // On curve changed notify</span><br><span class="line">    FCurveChangedPayload Payload;</span><br><span class="line">	Payload.Identifier = CurveId;</span><br><span class="line">	Model-&gt;Notify(EAnimDataModelNotifyType::CurveChanged, Payload);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Finally, go to <code>RichCurve.cpp</code> and you will see the definition of function <code>SetKeys</code>:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FRichCurve::SetKeys</span><span class="params">(<span class="type">const</span> TArray&lt;FRichCurveKey&gt;&amp; InKeys)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">Reset</span>();</span><br><span class="line"></span><br><span class="line">	Keys.<span class="built_in">SetNum</span>(InKeys.<span class="built_in">Num</span>());</span><br><span class="line">	KeyHandlesToIndices.<span class="built_in">SetKeyHandles</span>(InKeys.<span class="built_in">Num</span>());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (int32 Index = <span class="number">0</span>; Index &lt; InKeys.<span class="built_in">Num</span>(); ++Index)</span><br><span class="line">	&#123;</span><br><span class="line">		Keys[Index] = InKeys[Index];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">AutoSetTangents</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>which is pretty straightforward.</p>
<h1 id="import-animation"><a class="markdownIt-Anchor" href="#import-animation"></a> Import Animation</h1>
<p>Function <code>UnFbx::FFbxImporter::ImportBoneTracks</code> is responsible for importing bone animation tracks. Its pseudo code is as follows.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">foreach (BoneName : FbxRawBoneNames)</span><br><span class="line">&#123;</span><br><span class="line">    CheckValidity (BoneName)</span><br><span class="line"></span><br><span class="line">    FRawAnimSequenceTrack RawTrack</span><br><span class="line">    for (CurTime = StartTime; CurTime &lt; EndTime; CurTime += TimeInc)</span><br><span class="line">    &#123;</span><br><span class="line">        LocalTransform = GetLocalTransformFromRawMatrixData (CurTime)</span><br><span class="line">        RawTrack.ScaleKeys.Add(FVector3f(LocalTransform.GetScale3D()))</span><br><span class="line">		RawTrack.PosKeys.Add(FVector3f(LocalTransform.GetTranslation()))</span><br><span class="line">		RawTrack.RotKeys.Add(FQuat4f(LocalTransform.GetRotation()))</span><br><span class="line"></span><br><span class="line">        if (Success)</span><br><span class="line">        &#123;</span><br><span class="line">            if (SkeletonHasBone (BoneName))</span><br><span class="line">            &#123;</span><br><span class="line">                // Add a new track</span><br><span class="line">                Controller.AddBoneTrack(BoneName)</span><br><span class="line">				Controller.SetBoneTrackKeys(BoneName, RawTrack.PosKeys, RawTrack.RotKeys, RawTrack.ScaleKeys)</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                // Create animation attribute and add the transform keys</span><br><span class="line">                UE::Anim::AddTypedCustomAttribute&lt;FTransformAnimationAttribute, FTransform&gt;(...)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="import-bone-metadata"><a class="markdownIt-Anchor" href="#import-bone-metadata"></a> Import Bone Metadata</h1>
<p>The final step is to import the bone metadata. It simply calls the <code>ImportNodeCustomProperties(AnimSeq, SkeletonNode)</code> for each skeleton node.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">foreach (Property : NodeProperties)</span><br><span class="line">&#123;</span><br><span class="line">    MetadataTag = &quot;FBX.&quot; + NodeName + &quot;.&quot; + Property.GetName()</span><br><span class="line">    MetadataValue = GetFbxPropertyStringValue(Property)</span><br><span class="line">    AnimSeq-&gt;GetOutermost()-&gt;GetMetaData()-&gt;SetValue(AnimSeq, *MetadataTag, *MetadataValue)</span><br><span class="line"></span><br><span class="line">    foreach (ChildNode : NodeChildren)</span><br><span class="line">    &#123;</span><br><span class="line">        ImportNodeCustomProperties (AnimSeq, ChildNode)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Written by:  </strong>Sulley
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="http://sulley.cc/2023/02/19/12/52/" title="How are FBX files Imported in Unreal Engine">http://sulley.cc/2023/02/19/12/52/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" rel="tag"># 计算机</a>
              <a href="/tags/UE/" rel="tag"># UE</a>
              <a href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag"># 游戏</a>
              <a href="/tags/%E7%BC%96%E8%BE%91%E5%99%A8/" rel="tag"># 编辑器</a>
              <a href="/tags/%E5%8A%A8%E7%94%BB/" rel="tag"># 动画</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/02/09/23/21/" rel="prev" title="ComponentCameraSystem - A Simplified Camera System for You to Create Plentiful Gameplay Camera Movements and Effects">
                  <i class="fa fa-chevron-left"></i> ComponentCameraSystem - A Simplified Camera System for You to Create Plentiful Gameplay Camera Movements and Effects
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/03/02/10/53/" rel="next" title="Customizing Actor's Details Panel and Accessing its CDO Components">
                  Customizing Actor's Details Panel and Accessing its CDO Components <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Sulley</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">453k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:51</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"sulley","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
